//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit3.h"
#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm3 *Form3;
//---------------------------------------------------------------------------
__fastcall TForm3::TForm3(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm3::Napr_searchChange(TObject *Sender)
{
   ADOQuery2->Close();
   ADOQuery2->SQL->Clear();
   ADOQuery2->SQL->Add("use Practic_work");
   ADOQuery2->SQL->Add("SELECT * FROM Dist_With_Prepod");
   ADOQuery2->SQL->Add("JOIN Form_Of_Control ON Dist_With_Prepod.Form_Of_Control = Form_Of_Control.id");
   ADOQuery2->SQL->Add("JOIN Speciality ON Dist_With_Prepod.Speciality_Id = Speciality.id");
   ADOQuery2->SQL->Add("JOIN Subjects ON Dist_With_Prepod.Name_Dist = Subjects.id");
   ADOQuery2->SQL->Add("where Speciality.Name = '" + Napr_search->Text + "';");
   //ADOQuery1->SQL->Add("where Speciality.Name = 'Прикладная Математика и  Информатика';");
   //ShowMessage(ADOQuery1->SQL->Text);
   try
   {
	ADOQuery2->Open();
   }
   catch (Exception &e)
   {
	ShowMessage("Ошибка выполнения запроса: " + e.Message);
   }
}
//---------------------------------------------------------------------------
void __fastcall TForm3::Napr_searchDropDown(TObject *Sender)
{
   Napr_search->Items->Clear();
   Napr->Close();
   Napr->SQL->Clear();
   Napr->SQL->Add("use Practic_work");
   Napr->SQL->Add("SELECT * FROM Speciality");
   Napr->Open();
   while (!Napr->Eof)
   {
	  Napr_search->Items->Add(Napr->FieldByName("name")->AsString);
	  Napr->Next();
   }
}
//---------------------------------------------------------------------------
void __fastcall TForm3::DissiplChange(TObject *Sender)
{
   ADOQuery2->Close();
   ADOQuery2->SQL->Clear();
   ADOQuery2->SQL->Add("use Practic_work");
   ADOQuery2->SQL->Add("SELECT * FROM Dist_With_Prepod");
   ADOQuery2->SQL->Add("JOIN Form_Of_Control ON Dist_With_Prepod.Form_Of_Control = Form_Of_Control.id");
   ADOQuery2->SQL->Add("JOIN Speciality ON Dist_With_Prepod.Speciality_Id = Speciality.id");
   ADOQuery2->SQL->Add("JOIN Subjects ON Dist_With_Prepod.Name_Dist = Subjects.id");
   ADOQuery2->SQL->Add("where Speciality.Name = '" + Napr_search->Text + "'and subjects='" + Dissipl->Text + "'");
   //ADOQuery1->SQL->Add("where Speciality.Name = 'Прикладная Математика и  Информатика';");
   //ShowMessage(ADOQuery1->SQL->Text);
   ADOQuery2->Open();
}
//---------------------------------------------------------------------------
void __fastcall TForm3::DissiplDropDown(TObject *Sender)
{
   Dissipl->Items->Clear();
   Napr->Close();
   Napr->SQL->Clear();
   Napr->SQL->Add("use Practic_work");
   Napr->SQL->Add("SELECT * FROM Dist");
   Napr->SQL->Add("JOIN Form_Of_Control ON Dist.Form_Of_Control = Form_Of_Control.id");
   Napr->SQL->Add("JOIN Speciality ON Dist.Speciality_Id = Speciality.id");
   Napr->SQL->Add("JOIN Subjects ON Dist.Name_Dist = Subjects.id");
   Napr->SQL->Add("where Speciality.Name = '" + Napr_search->Text + "';");
   //ADOQuery1->SQL->Add("where Speciality.Name = 'Прикладная Математика и  Информатика';");
   //ShowMessage(ADOQuery1->SQL->Text);
   Napr->Open();

   for(int i=0; i<(Napr->RecordCount); i++)
   {
	  bool pool=true;
	  for(int j=0; j < Dissipl->Items->Count; j++ )
	   if((Napr->FieldByName("subjects")->AsString)==(Dissipl->Items->Strings[j]))
	   {
		 pool=false;
		 break;
	   }
		if(pool) Dissipl->Items->Add(Napr->FieldByName("subjects")->AsString);
		Napr->Next();
   }
}
//---------------------------------------------------------------------------
void __fastcall TForm3::SemestrChange(TObject *Sender)
{
   ADOQuery2->Close();
   ADOQuery2->SQL->Clear();
   ADOQuery2->SQL->Add("use Practic_work");
   ADOQuery2->SQL->Add("SELECT * FROM Dist");
   ADOQuery2->SQL->Add("JOIN Form_Of_Control ON Dist.Form_Of_Control = Form_Of_Control.id");
   ADOQuery2->SQL->Add("JOIN Speciality ON Dist.Speciality_Id = Speciality.id");
   ADOQuery2->SQL->Add("JOIN Subjects ON Dist.Name_Dist = Subjects.id");
   ADOQuery2->SQL->Add("where Speciality.Name = '" + Napr_search->Text + "'and subjects='" + Dissipl->Text + "' and semestr="+Semestr->Text);
   //ADOQuery1->SQL->Add("where Speciality.Name = 'Прикладная Математика и  Информатика';");
   //ShowMessage(ADOQuery1->SQL->Text);
   ADOQuery2->Open();

   /*
   if(!ADOQuery2->IsEmpty())
   {
			audit->EditMask = "Общее кол-во часов: ";
			audit->Text = ADOQuery2->FieldByName("In_Audience")->AsString;

			lec->EditMask = "Лекции: ";
			lec->Text = ADOQuery2->FieldByName("Lecture_Hours")->AsString;

			prac->EditMask = "Практики: ";
			prac->Text = ADOQuery2->FieldByName("Practice_Hours")->AsString;

			lab->EditMask = "Лабораторные: ";
			lab->Text = ADOQuery2->FieldByName("Lab_Hours")->AsString;

			semenar->EditMask = "Семенары: ";
			semenar->Text = ADOQuery2->FieldByName("Semenars")->AsString;

			sam->EditMask = "Самостоятельные: ";
			sam->Text = ADOQuery2->FieldByName("Independent_Hours")->AsString;
   }
   else
   {
		   audit->Clear();
		   lec->Clear();
		   prac->Clear();
		   lab->Clear();
		   semenar->Clear();
		   sam->Clear();

		   audit->Text = "Аудиторные часы";
		   lec->Text = "Лекции";
		   prac->Text = "Практики";
		   lab->Text = "Лабораторные";
		   semenar->Text = "Семенары";
		   sam->Text = "Самостоятельные";
   }
   */


   ADOQuery2->Close();
   ADOQuery2->SQL->Clear();
   ADOQuery2->SQL->Add("use Practic_work");
   ADOQuery2->SQL->Add("SELECT * FROM Dist_With_Prepod");
   ADOQuery2->SQL->Add("JOIN Form_Of_Control ON Dist_With_Prepod.Form_Of_Control = Form_Of_Control.id");
   ADOQuery2->SQL->Add("JOIN Speciality ON Dist_With_Prepod.Speciality_Id = Speciality.id");
   ADOQuery2->SQL->Add("JOIN Subjects ON Dist_With_Prepod.Name_Dist = Subjects.id");
   ADOQuery2->SQL->Add("where Speciality.Name = '" + Napr_search->Text + "'and subjects='" + Dissipl->Text + "' and semestr="+Semestr->Text);
   //ADOQuery1->SQL->Add("where Speciality.Name = 'Прикладная Математика и  Информатика';");
   //ShowMessage(ADOQuery1->SQL->Text);
   ADOQuery2->Open();

}
//---------------------------------------------------------------------------
